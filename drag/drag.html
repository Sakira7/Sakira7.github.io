<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="manifest" href="drag-manifest.json"/>
        <meta name="msapplication-TileColor" content="#222">
        <meta name="theme-color" content="#000">
        <title>Drag</title>
        <link href="drag.css?v=1" rel="stylesheet">
        
    </head>
    <body>
        <script>
        
                async function central(){

                    const base = `https://proxy-9x3u.onrender.com/api`;
                    const target = `https://connect.idpit.se/jpinfo.php?format=json`;
                    fetch(`${base}?url=${encodeURIComponent(target)}&t=${Date.now()}`)
                    .then(res => res.json())
                    .then(data => {
                        const eldo = data[0].eldorado;
                        const drom = data[0].drom;
                        const sp1 = data[0].rad1;
                        const sp2 = data[0].rad2;
                        const sp3 = data[0].rad3;
                        document.getElementById("eldo").value = eldo;
                        document.getElementById("sp1").value = sp1;
                        document.getElementById("sp2").value = sp2;
                        document.getElementById("sp3").value = sp3;
                        document.getElementById("dp").value = drom;

                    })
                    .catch(err => console.error("Fetch error:", err));

                }

            window.addEventListener("load", function fill(){

                central();
                console.log("updated");

                let col = document.querySelectorAll(".game");
                let val = col.length;
                document.getElementById("last_updt").innerHTML = localStorage.getItem("last_updt");

                for(var i = 0; i < val; i++){
                    if(window.localStorage.length > 0){
                        col[i].value = localStorage.getItem("value"+i);   
                    }
                }
               
            });

                window.addEventListener("keydown", (e)=>{
                    if(e.target.nodeName == "INPUT"){
                        if(!e.key.match(/[0-9]/) && e.key != "Backspace" && e.key != "Tab" && e.key != "ArrowLeft" && e.key != "ArrowRight"){
                            e.preventDefault();
                        }
                    }else if(e.key === "a"){
                        let eldo = document.querySelector("#eldo");
                        let drom = document.querySelector("#dp");
                        let sp1 = document.querySelector("#sp1");
                        let sp2 = document.querySelector("#sp2");
                        let sp3 = document.querySelector("#sp3");
                        let all = [eldo, drom, sp1, sp2, sp3];

                        for(var i = 0; i < all.length; i++){
                            if(all[i].hasAttribute("disabled", "")){
                                all[i].removeAttribute("disabled", "");
                            }else if(!all[i].hasAttribute("disabled", "")){
                                all[i].setAttribute("disabled", "");
                            }
                        }

                    }else if(e.ctrlKey &&(e.key === "u")){
                        forceUpdate();
                    }

                });

                function forceUpdate(){
                    const url = new URL(window.location.href);
                    url.searchParams.set('_update', Date.now().toString());
                    window.location.replace(url.toString());
                }

                window.addEventListener("beforeunload", ()=>{
                    closeWindow();
                });



        </script>
        <div class="content">
            <form id="jackpot">
                <div id="left-row">
                    <p id="rubrik1">Lokala spel</p>

                    <span class="wrap"><label class="game_name" for="zata">Zäta</label>
                        <input type="text" class="game" id="zata" placeholder="30" maxlength="2" autocomplete="off"></span>

                    <span class="wrap"><label class="game_name" for="fc">Färgchansen</label>
                        <input type="text" class="game" id="fc" placeholder="55" maxlength="2" autocomplete="off"></span>


                    <span class="wrap"><label class="game_name" for="ss1">Sjöstjärnan</label>
                        <input type="text" class="game" id="ss1" placeholder="8" maxlength="2" autocomplete="off">
                        <input type="text" class="game" id="ss2" placeholder="35" maxlength="2" autocomplete="off">
                        <input type="text" class="game" id="ss3" placeholder="54" maxlength="2" autocomplete="off"></span>

                    <span class="wrap"><label class="game_name" for="jr">Jackpottresan</label>
                        <input type="text" class="game" id="jr" placeholder="3000" maxlength="5" autocomplete="off"></span>

                    <span class="sb"><label class="game_name" for="sb">SingelBygg</label>
                        <span class="sb60">
                        <input type="text" class="game" id="sb160" placeholder="500" maxlength="5" autocomplete="off">
                        <input type="text" class="game" id="sb260" placeholder="1000" maxlength="5" disabled></span>
                    </span>

                        <div id="extras">
                            <div id="widget-selector">
                                <select name="widgets" id="widgets">
                                    <option value="default" selected>-VÄLJ-</option>
                                    <option value="klocka">Klocka</option>
                                    <option value="info-box">Info-box</option>
                                </select>
                            </div>
                            <div id="info-box" hidden>
                                <div id="border">
                                    <select name="info-select" id="info-select">
                                        <option value="default" selected>-VÄLJ-</option>
                                        <option value="Missa inte:">Missa inte:</option>
                                        <option value="Kom ihåg:">Kom ihåg:</option>
                                        <option value="Tänk på:">Tänk på:</option>
                                        <option value="blank">Ingen text</option>
                                    </select>
                                    <div id="editable-content">
                                        <div id="info-input" contenteditable></div>
                                        <div id="opt"><button id="b">B</button><br><button id="i">i</button><br><button id="h" hidden>H</button></div>
                                    </div>
                                </div>
                            </div>
                            <div id="clock" hidden>
                                <div id="time"></div>
                            </div>
                        </div>

                        
                </div>


                <div id="right-row">
                    <p id="rubrik2">Centrala spel</p>
                    <span class="wrap"><label class="game_name" for="eldo">Eldorado</label>
                        <input type="text" class="game" id="eldo" placeholder="30000" maxlength="6">
                    </span><br>

                            <label class="container">
                                <input type="checkbox" id="cb_at">
                                <span class="checkmark" id="tog_at"></span>
                            </label>

                            <span class="wrap">
                                <label class="game_name" for="at" id="atlantis">Atlantis</label>
                                <input type="text" class="game" id="at" value="10000" placeholder="10000" maxlength="6" disabled>
                            </span><br>
    
                            <span class="wrap">
                                <label class="game_name" for="sp" >Superpotten</label>
                                <p class="info">Spelas den <input type="date" id="date" class="game" placeholder="2025-01-01"></p>
                            </span><br>
                                <div class="space2"></div>
                                <span class="wrapper">
                                    <span class="row" id="row1">Rad 1 -</span><input type="text" class="game" id="sp1" placeholder="10000" maxlength="6">
                                </span>
                                <span class="wrapper">
                                    <span class="row">Rad 2 -</span><input type="text" class="game" id="sp2" placeholder="20000" maxlength="6">
                                </span>
                                <span class="wrapper">
                                    <span class="row">Rad 3 -</span><input type="text" class="game" id="sp3" placeholder="30000" maxlength="6">
                                </span><br>

                            <label class="container">
                                <input type="checkbox" id="cb_dp">
                                <span class="checkmark" id="tog_dp"></span>
                            </label>

                            <span class="wrap">
                                <label class="game_name" for="dp" id="drompotten">Drömpotten</label>
                                <input type="text" class="game" id="dp" placeholder="1000000" maxlength="7">
                            </span><br>

                            <div class="space"></div>
                        
                    <span class="wrap" id="tb_wrap_edit">
                        <label class="game_name" for="tb">Turbollen</label>
                        <input type="text" class="game" id="tb" placeholder="3000" maxlength="5">
                        <input type="text" class="game" id="tb_nr" placeholder="0" maxlength="2">
                        
                    </span>
                </div>
            </form>
            <div id="bottom">
                <button id="show_btn" class="btn" onclick="update(central)">UPPDATERA DRAG</button>
                <div id="last_updt"></div>
            </div>
            <div id="pop-up">  
                <div id="pop-up-content">
                    <p id="pop-up-text">Fyll i alla fält</p>
                    <span id="ok" class="btn">OK</span>
                </div>
            </div>
        </div>
        <script src="drag.js?v=1"></script>
    </body>
</html>